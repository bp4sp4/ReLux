<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/default}">

<section layout:fragment="contents">
	<main class="main__wrap">
		<section class="main__wrap__brand">
			<div class="main__filter">
				<div class="main__brand__title">
					<p class="main__brand__title__sz">Brand</p>
					<div id="resetBtn" class="main__brand__resetbtn">
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
							fill="currentColor" class="bi bi-arrow-counterclockwise"
							viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
								d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2z" />
                            <path
								d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466" />
                        </svg>
						<span>초기화</span>
					</div>
				</div>

				<!-- 연령대 -->
				<section class="main__brand__choice" id="ageFilter" name="age">
					<div id="main__brand__category">
						<p>연령대</p>
						<div class="main__brand__option">
							<input type="radio" name="age" value="전체" checked>
							<p>전체</p>
						</div>
						<div class="main__brand__option">
							<input type="radio" name="age" value="10">
							<p>10대</p>
						</div>
						<div class="main__brand__option">
							<input type="radio" name="age" value="20">
							<p>20대</p>
						</div>
						<div class="main__brand__option">
							<input type="radio" name="age" value="30">
							<p>30대</p>
						</div>
						<div class="main__brand__option">
							<input type="radio" name="age" value="40">
							<p>40대</p>
						</div>
						<div class="main__brand__option">
							<input type="radio" name="age" value="50">
							<p>50대</p>
						</div>
					</div>

					<!-- 브랜드 -->
					<div class="main__brand__category2" id="brandFilter">
						<p>브랜드</p>
						<div class="main__brand__option2">
							<input type="radio" name="brand" value="전체" checked>
							<p>전체</p>
						</div>
						<div class="main__brand__option2">
							<input type="radio" name="brand" value="Louis Vuitton">
							<p>루이비통(Louis Vuitton)</p>
						</div>
						<div class="main__brand__option2">
							<input type="radio" name="brand" value="Chanel">
							<p>샤넬(Chanel)</p>
						</div>
						<div class="main__brand__option2">
							<input type="radio" name="brand" value="Prada">
							<p>프라다</p>
						</div>
						<div class="main__brand__option2">
							<input type="radio" name="brand" value="Comme des Garçons">
							<p>꼼데가르송(Comme des Garçons)</p>
						</div>
						<div class="main__brand__option2">
							<input type="radio" name="brand" value="Saint Laurent">
							<p>입생로랑(Saint Laurent)</p>
						</div>
					</div>

					<!-- 가격 -->
					<div class="main__price__slider">
						<p>가격</p>
						<input type="range" id="priceRange" min="0" max="10000000"
							value="0" step="1000000"> <label for="priceRange">가격
							범위: <span id="priceValue">0만원</span>
						</label>
					</div>

				</section>
			</div>

			<!-- 검색 결과 -->
			<div id="brandList" class="main__brand__imgwrap">
				<p th:text="${brand != null ? '전체 ' + brand.size() + '개' : '전체 0개'}"></p>
				<a th:each="brand : ${brand}" class="main__brand__thumbnail"
					href="#"> <img th:src="${brand.brandImagePath}"
					alt="Brand Image" />
					<div class="main__brand__thumbnail__desc">
						<div class="main__brand__thumbnail__desc__title">
							<p th:text="${brand.brandname}">브랜드명</p>
							<p th:text="${brand.productName}">제품명</p>
						</div>
						<div class="main__brand__thumbnail__desc__price">
							<p th:text="${#numbers.formatInteger(brand.brandPrice, 3, 'COMMA')} + '원'">98,500원</p>
						</div>
					</div>
				</a>
			</div>
		</section>

		<!-- 페이지네이션 -->
		<nav class="brand__pagenation" aria-label="Page navigation example">
			<ul class="pagination justify-content-center">
				<li class="page-item disabled"><a class="page-link" href="#"
					tabindex="-1">이전</a></li>
				<li class="page-item"><a class="page-link" href="#">1</a></li>
				<li class="page-item"><a class="page-link" href="#">2</a></li>
				<li class="page-item"><a class="page-link" href="#">3</a></li>
				<li class="page-item"><a class="page-link" href="#">4</a></li>
				<li class="page-item"><a class="page-link" href="#">5</a></li>
				<li class="page-item"><a class="page-link" href="#">다음</a></li>
			</ul>
		</nav>
	</main>
</section>

<script layout:fragment="script">
$(document).ready(function() {
    const priceRange = $('#priceRange');
    const priceValue = $('#priceValue');

    // 가격 범위 표시 : 100만원 , 200만원
    priceRange.on('input', function() {
    	   priceValue.text((priceRange.val() / 10000) + '만원이상');
    });

    // 연령대 및 브랜드 라디오 버튼에서 변경 이벤트
    $('input[name="age"], input[name="brand"], #priceRange').on('change', function() {
        const age = $('input[name="age"]:checked').val(); 
        const brand = $('input[name="brand"]:checked').val(); 
        const maxPrice = priceRange.val(); 

        $.ajax({
            url: '/brand/filterList', 
            method: 'GET',
            data: {
                age: age,
                brand: brand,
                maxPrice: maxPrice
            },
            success: function(data) {
                console.log('필터링된 브랜드 리스트:', data);

                const brandListContainer = $('#brandList'); 
                brandListContainer.empty();
                brandListContainer.append(`<p>전체 ${data.length}개</p>`);

                // forEach() 화살표함수 사용                 
                data.forEach(brand => {
                    const brandItem = `
                        <a class="main__brand__thumbnail" href="#">
                            <img src="${brand.brandImagePath}" alt="Brand Image" />
                            <div class="main__brand__thumbnail__desc">
                                <div class="main__brand__thumbnail__desc__title">
                                    <p>${brand.brandname}</p>
                                    <p>${brand.productName || '제품명 없음'}</p>
                                </div>
                                <div class="main__brand__thumbnail__desc__price">
                                    <p>${brand.brandPrice.toLocaleString()} 원</p>
                                </div>
                            </div>
                        </a>
                    `;
                    brandListContainer.append(brandItem); 
                });
            },
            error: function(error) {
                console.error('오류 발생:', error);
            }
        });
    });

});
</script>

</html>
